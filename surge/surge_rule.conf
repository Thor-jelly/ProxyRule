# å®˜æ–¹æ‰‹å†Œ - https://manual.nssurge.com/
# ç†è§£åŸç† - https://manual.nssurge.com/book/understanding-surge/cn/
# å¸®åŠ©ä¸­å¿ƒ - https://nssurge.zendesk.com/
# æŠ€æœ¯ç¤¾åŒº - https://community.nssurge.com
#æ‘˜è‡ªhttps://raw.githubusercontent.com/As-Lucky/Lucky/main/Lucky-Surge.conf
#https://github.com/blackmatrix7/ios_rule_script

#è‡ªç”¨é…ç½®
[General]
# > æµ‹è¯•è¶…æ—¶ï¼ˆç§’ï¼‰
test-timeout = 3
# > å›½å†… æµ‹è¯• URL
internet-test-url = http://www.baidu.com
# > ä»£ç†æµ‹é€Ÿ URL
proxy-test-url = http://cp.cloudflare.com/generate_204

# > è‡ªå®šä¹‰ GeoIP æ•°æ®åº“
geoip-maxmind-url = https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb

# > å…è®¸ Wi-Fi è®¿é—® (ä»… iOSï¼Œè‹¥å…è®¸è¿œç¨‹è®¿é—®å°†ã€Œfalseã€æ”¹ä¸ºã€Œtrueã€)
allow-wifi-access = false
wifi-access-http-port = 6152
wifi-access-socks5-port = 6153
# > å¢å¼ºç‰ˆ Wi-Fi åŠ©ç†
wifi-assist = true

# > IPv6 æ”¯æŒï¼ˆé»˜è®¤å…³é—­ï¼‰
ipv6 = true
# > Surge VIF IPv6 Stack
# > å…è®¸ IPv6 é€šè¿‡ Surge VIFã€‚å½“å¸Œæœ› Surge å¤„ç†è¿æ¥åˆ° IPv6 åœ°å€çš„åŸå§‹ TCP è¿æ¥æ—¶éå¸¸æœ‰ç”¨ã€‚å¯é€‰é¡¹ï¼štrueï¼Œfalseï¼Œautoï¼Œalways
ipv6-vif = auto

# > è¿œç¨‹æ§åˆ¶å™¨
http-api-web-dashboard = false

# > å…¼å®¹æ¨¡å¼ (ä»… iOS)
# compatibility-mode = 0

# > è·³è¿‡ä»£ç†
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, 17.0.0.0/8, localhost, *.local, *.crashlytics.com
# > æ’é™¤ç®€å•ä¸»æœºå
exclude-simple-hostnames = true

# > ä» /etc/hosts è¯»å– DNS è®°å½•
read-etc-hosts = true
# > DNS æœåŠ¡å™¨
dns-server = 119.29.29.29, 2402:4e00::, 223.5.5.5, 2400:3200::1, 8.8.8.8, 2001:4860:4860::8888, system
# > DNS over QUIC
# encrypted-dns-server = quic://223.5.5.5
encrypted-dns-server = quic://dns.alidns.com
# encrypted-dns-follow-outbound-mode = true
# encrypted-dns-skip-cert-verification = true

# > æ—¥å¿—çº§åˆ«
loglevel = notify

# > å½“é‡åˆ° REJECT ç­–ç•¥æ—¶è¿”å›é”™è¯¯é¡µ
show-error-page-for-reject = true

# > Always Real IP Hosts
always-real-ip = *.msftconnecttest.com, *.msftncsi.com, *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, *.logon.battlenet.com.cn, *.logon.battle.net, stun.l.google.com

# > VIF Excluded Routes
# tun-excluded-routes = 239.255.255.250/32

# å¦‚æœæ²¡æœ‰ä»£ç†æœåŠ¡å™¨æ”¯æŒ UDP è½¬å‘ï¼Œå¯ä¿®æ”¹ä¸ºã€Œ direct ã€æˆ–æ³¨é‡Šä¸‹æ¡ï¼Œä½†éœ€æ³¨æ„åŒä¸€ç›®æ ‡ä¸»æœºå TCP è¯·æ±‚ä¸ UDP è¯·æ±‚çš„æºåœ°å€ä¸åŒæ‰€é€ æˆçš„éšç§åŠå®‰å…¨é£é™©ã€‚
udp-policy-not-supported-behaviour = reject

[Replica]
# > éšè— Apple è¯·æ±‚
hide-apple-request = 1
# > éšè—å´©æºƒè¿½è¸ªå™¨è¯·æ±‚
hide-crash-reporter-request = 1
# > éšè— UDP ä¼šè¯
hide-udp = 0
# > å…³é”®è¯è¿‡æ»¤å™¨
keyword-filter-type = none

[Proxy]
# ç›´æ¥è¿æ¥
DIRECT = direct

[Proxy Group]
# æ‰‹åŠ¨é€‰æ‹©
ç½‘é€Ÿè¶…å¿« = select, no-alert=0, hidden=0, include-all-proxies=1, update-interval=0, policy-path=ä½ çš„è®¢é˜…é“¾æ¥
# é¦™æ¸¯åˆ†æµ
é¦™æ¸¯ = select, no-alert=0, hidden=0, include-all-proxies=0, update-interval=0, policy-regex-filter=(?=.*(ğŸ‡­ğŸ‡°|æ¸¯|HK|(?i)Hong))^((?!(3å€)).)*$, include-other-group=ç½‘é€Ÿè¶…å¿«
# å°æ¹¾åˆ†æµ
å°æ¹¾ = select, no-alert=0, hidden=0, include-all-proxies=0, update-interval=0, policy-regex-filter=(ğŸ‡¨ğŸ‡³)|(å°)|(Tai)|(TW), include-other-group=ç½‘é€Ÿè¶…å¿«
# æ—¥æœ¬åˆ†æµ
æ—¥æœ¬ = select, no-alert=0, hidden=0, include-all-proxies=0, update-interval=0, policy-regex-filter=(ğŸ‡¯ğŸ‡µ)|(æ—¥)|(Japan)|(JP), include-other-group=ç½‘é€Ÿè¶…å¿«
# æ–°åŠ å¡åˆ†æµ
æ–°åŠ å¡ = select, no-alert=0, hidden=0, include-all-proxies=0, update-interval=0, policy-regex-filter=(ğŸ‡¸ğŸ‡¬)|(å¡)|(Singapore)|(SG), include-other-group=ç½‘é€Ÿè¶…å¿«
# ç¾å›½åˆ†æµ
éŸ©å›½ = select, no-alert=0, hidden=0, include-all-proxies=0, update-interval=0, policy-regex-filter=(ğŸ‡°ğŸ‡·)|(éŸ©)|(KR), include-other-group=ç½‘é€Ÿè¶…å¿«
# éŸ©å›½åˆ†æµ
ç¾å›½ = select, no-alert=0, hidden=0, include-all-proxies=0, update-interval=0, policy-regex-filter=(ğŸ‡ºğŸ‡¸)|(ç¾)|(States)|(US), include-other-group=ç½‘é€Ÿè¶…å¿«
# ç½‘æ˜“äº‘è§£ç°è‰² = select, policy-path=https://gist.githubusercontent.com/As-Lucky/93af45f81dcbd70d7079d3fc327706e0/raw/wyy, update-interval=0, no-alert=0, hidden=0, include-all-proxies=0

[Rule]
# ç½‘æ˜“äº‘è§£é”ç°è‰²
# RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/NetEaseMusic/NetEaseMusic.list,ç½‘æ˜“äº‘è§£ç°è‰²

# ---åŸŸåè§„åˆ™---
# ç¾å›¢
DOMAIN-SUFFIX,d.meituan.net,DIRECT // Added for: route-stats.d.meituan.net:443
DOMAIN-SUFFIX,speedv6.m.jd.com,DIRECT // Added for: speedv6.m.jd.com:443
DOMAIN-SUFFIX,spotify.com,DIRECT
DOMAIN-SUFFIX,zhuishudashi.net,DIRECT // Added for: g-lens2.zhuishudashi.net:443

# > å…¶å®ƒ
DOMAIN-SUFFIX,local,DIRECT
# ---è¿›ç¨‹è§„åˆ™---
# > åªåœ¨macOSç”Ÿæ•ˆï¼ŒiOSä¼šè‡ªåŠ¨å¿½ç•¥è¿™ä¸ªç±»å‹çš„è§„åˆ™
PROCESS-NAME,UUBooster,DIRECT
# ---é€»è¾‘è§„åˆ™---
# > ANDè§„åˆ™:å½“æ‰€å«è§„åˆ™å…¨éƒ¨åŒ¹é…æ—¶ï¼Œä¼šè¢«è§¦å‘
AND,((PROTOCOL,UDP), (DEST-PORT,443)),REJECT-NO-DROP
# ---è§„åˆ™é›†----
# ---å†…ç½®è§„åˆ™é›†---
# SYSTEM
# > åŒ…å«äº†ç»å¤§å¤šæ•°æ¥è‡ªmacOSå’ŒiOSç³»ç»Ÿæœ¬èº«æ‰€å‘é€çš„è¯·æ±‚
RULE-SET,SYSTEM,DIRECT

# ---è¿œç¨‹è§„åˆ™é›†---
# è‡ªå·±
RULE-SET,https://raw.githubusercontent.com/Thor-jelly/ProxyRule/master/clash/my_direct.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/Thor-jelly/ProxyRule/master/clash/us.list,ç¾å›½
# è§„åˆ™ä¿®æ­£
# RULE-SET,https://raw.githubusercontent.com/DivineEngine/Profiles/master/Surge/Ruleset/Unbreak.list,DIRECT
# å»å¹¿å‘Š
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Advertising/Advertising_All.list,REJECT
# éšç§
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Privacy/Privacy_All.list,REJECT
# è¿è¥å•†åŠ«æŒæˆ–æ¶æ„ç½‘ç«™
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Hijacking/Hijacking.list,REJECT
# > æœ¬åœ°/å±€åŸŸç½‘åœ°å€
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Lan/Lan.list,DIRECT
# > China è½¯ä»¶&æœåŠ¡
# Apple æœåŠ¡
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Apple/Apple_All.list,DIRECT
# è…¾è®¯ WeChat
RULE-SET,https://github.com/NobyDa/Script/raw/master/Surge/WeChat.list,DIRECT
# ä¸‹è½½
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Download/Download.list,DIRECT
# > è½¯ä»¶&æœåŠ¡
# OpenAI
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/OpenAI/OpenAI.list,ç¾å›½
# Gemini
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Loon/Gemini/Gemini.list,ç¾å›½
# Claude
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Loon/Claude/Claude.list,ç¾å›½
# å¼€å‘
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Developer/Developer.list,ç½‘é€Ÿè¶…å¿«
# Microsoft
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Microsoft/Microsoft.list,ç½‘é€Ÿè¶…å¿«
# > ç¤¾äº¤å¹³å°
# Telegram
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Telegram/Telegram.list,ç½‘é€Ÿè¶…å¿«
# > æ¸¸æˆå¹³å°
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Epic/Epic.list,ç½‘é€Ÿè¶…å¿«
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Sony/Sony.list,ç½‘é€Ÿè¶…å¿«
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Steam/Steam.list,ç½‘é€Ÿè¶…å¿«
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Nintendo/Nintendo.list,ç½‘é€Ÿè¶…å¿«
# > åª’ä½“
# YouTube
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/YouTube/YouTube.list,ç½‘é€Ÿè¶…å¿«
# å¥ˆé£
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Netflix/Netflix.list,ç½‘é€Ÿè¶…å¿«
# è¿ªå£«å°¼
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Disney/Disney.list,ç½‘é€Ÿè¶…å¿«
# > ç›´è¿
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/China/China_All.list,DIRECT
# > ä»£ç†
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Proxy/Proxy_All.list,ç½‘é€Ÿè¶…å¿«
# > Surge çš„è‡ªåŠ¨ REJECT ä¿æŠ¤ä¸¢åŒ…ï¼Œé˜²æ­¢åº”ç”¨å¾ªç¯è¯·æ±‚
IP-CIDR,0.0.0.0/32,REJECT,no-resolve
# > å±€åŸŸç½‘åœ°å€
RULE-SET,LAN,DIRECT
# > GeoIP China
GEOIP,CN,DIRECT
# > DNS æŸ¥è¯¢å¤±è´¥èµ°Finalè§„åˆ™
FINAL,ç½‘é€Ÿè¶…å¿«,dns-failed

[Host]
# ---å®šä¹‰æœ¬åœ°DNSè®°å½•---
# è¯¥åŠŸèƒ½ç­‰åŒäº /etc/hostsï¼ŒåŠ ä¸Šäº†æ³›è§£æå’Œåˆ«åæ”¯æŒã€‚
# > PlayStation
*.dl.playstation.net = server:119.29.29.29
# > æ·˜å®
*.taobao.com = server:223.5.5.5
# > å¤©çŒ«
*.tmall.com = server:223.5.5.5
# > é˜¿é‡Œäº‘
*.alicdn.com = server:223.5.5.5
*.aliyun.com = server:223.5.5.5
# > è…¾è¿…
*.tencent.com = server:119.29.29.29
# > è…¾è®¯QQ
*.qq.com = server:119.29.29.29
# > å¾®ä¿¡
*.weixin.com = server:119.29.29.29
*.qpic.cn = server:119.29.29.29
# > äº¬ä¸œ
*.jd.com = server:119.29.29.29
# > ç½‘æ˜“
*.netease.com = server:119.29.29.29
# > å°ç±³
*.mi.com = server:119.29.29.29
*.xiaomi.com = server:119.29.29.29
# > Firebase Cloud Messaging
mtalk.google.com = 108.177.125.188
# Apple TestFlight
# *testflight.apple.com = server:8.8.4.4
# è§£é”äº†ã€Œæ¨¡å—ã€åŠŸèƒ½çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ General.sgmodule åå¯ç§»é™¤ [URL Rewrite] åŠ [MITM] çš„ã€Œhostname = www.google.cn,api.abema.ioã€éƒ¨åˆ†
# å»ºè®®ä½¿ç”¨ General.sgmoduleï¼Œå…¶ä»– .sgmodule æŒ‰éœ€åŠ å…¥
# æœªè§£é”ã€Œæ¨¡å—ã€åŠŸèƒ½çš„ç”¨æˆ·ä¸è¦åˆ é™¤ä»¥ä¸‹å†…å®¹ï¼Œå‚ç…§
# (https://github.com/DivineEngine/Profiles/tree/master/Surge)ä½¿ç”¨å¿«æ·æŒ‡ä»¤æ›´æ–°ç›¸å…³å†…å®¹ã€‚

[URL Rewrite]
^https?:\/\/(www\.)?g\.cn https://www.google.com 302
^https?:\/\/(www\.)?google\.cn https://www.google.com 302

[Header Rewrite]
# è§£å†³githubé€Ÿç‡é™åˆ¶è¿”å›429é—®é¢˜
http-request ^https://.*\.githubusercontent\.com\/ header-replace Accept-Language en-us

[MITM]
skip-server-cert-verify = true
tcp-connection = true
h2 = true
hostname = *, %APPEND% pan.baidu.com, *account.wps.cn, *account.wps.com, api22-normal-c-alisg.tiktokv.com:443, webcast-normal.tiktokv.com:443, %APPEND% www.google.cn, www.g.cn, *.githubusercontent.com
hostname-disabled = *

